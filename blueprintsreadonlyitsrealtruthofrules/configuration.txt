graph TD
  %% ----------------- SYSTEM INIT -----------------
  subgraph INIT ["System Initialization Order"]
    %% 1. Core modules
    HealthInit["Health.ts"]
    OwnershipInit["Ownership.ts"]
    SafeModeInit["SafeMode.ts"]
    TimeModuleInit["TimeModule.ts"]
    OwnerModuleInit["OwnerModule.ts"]

    %% 2. Database & Repositories
    DatabaseInit["Database.ts"]
    RepositoriesInit["Repositories.ts"]

    %% 3. Locks
    AllianceLockInit["AllianceLock.ts"]
    GlobalLockInit["GlobalLock.ts"]

    %% 4. Alliance system core
    RoleModuleInit["RoleModule.ts"]
    ChannelModuleInit["ChannelModule.ts"]
    BroadcastModuleInit["BroadcastModule.ts"]
    AllianceSystemInit["AllianceSystem.ts"]
    TransferLeaderSystemInit["TransferLeaderSystem.ts"]

    %% 5. Snapshot system
    IntegrityMonitorInit["IntegrityMonitor.ts"]
    RepairServiceInit["RepairService.ts"]
    SnapshotServiceInit["SnapshotService.ts"]

    %% 6. Engine & Dispatcher
    DispatcherInit["Dispatcher.ts"]
    MutationGateInit["MutationGate.ts"]
    CommandDispatcherInit["CommandDispatcher.ts"]

    %% 7. Features & Orchestration
    AllianceIntegrityInit["AllianceIntegrity.ts"]
    AllianceCreationOrchestratorInit["AllianceCreationOrchestrator.ts"]
    AllianceServiceInit["AllianceService.ts"]

    %% 8. Discord client
    ClientInit["client.ts"]

    %% 9. Journal
    JournalInit["Journal.ts"]
    JournalTypesInit["JournalTypes.ts"]

    %% 10. Commands
    CommandLoaderInit["CommandLoader.ts"]
    CommandRegistryInit["CommandRegistry.ts"]
    CommandInit["Command.ts"]
    ALLIANCE_CMDS_INIT["alliance commands"]
    SYS_CMDS_INIT["sys commands"]
  end

  %% ----------------- INIT FLOW -----------------
  %% Core modules
  HealthInit --> OwnershipInit
  OwnershipInit --> SafeModeInit
  SafeModeInit --> TimeModuleInit
  TimeModuleInit --> OwnerModuleInit

  %% Database
  OwnerModuleInit --> DatabaseInit
  DatabaseInit --> RepositoriesInit

  %% Locks
  RepositoriesInit --> AllianceLockInit
  RepositoriesInit --> GlobalLockInit

  %% Alliance system
  AllianceLockInit --> RoleModuleInit
  GlobalLockInit --> RoleModuleInit
  RoleModuleInit --> ChannelModuleInit
  ChannelModuleInit --> BroadcastModuleInit
  BroadcastModuleInit --> AllianceSystemInit
  AllianceSystemInit --> TransferLeaderSystemInit

  %% Snapshot system
  DatabaseInit --> IntegrityMonitorInit
  IntegrityMonitorInit --> RepairServiceInit
  RepairServiceInit --> SnapshotServiceInit

  %% Engine & Dispatcher
  CommandDispatcherInit --> DispatcherInit
  DispatcherInit --> MutationGateInit
  OwnerModuleInit --> CommandDispatcherInit

  %% Features & Orchestration
  AllianceSystemInit --> AllianceIntegrityInit
  AllianceIntegrityInit --> AllianceCreationOrchestratorInit
  AllianceCreationOrchestratorInit --> AllianceServiceInit

  %% Discord
  AllianceServiceInit --> ClientInit
  CommandDispatcherInit --> ClientInit

  %% Journal
  AllianceSystemInit --> JournalInit
  AllianceSystemInit --> JournalTypesInit

  %% Commands
  CommandLoaderInit --> CommandRegistryInit
  CommandRegistryInit --> CommandInit
  CommandInit --> ALLIANCE_CMDS_INIT
  CommandInit --> SYS_CMDS_INIT
  ALLIANCE_CMDS_INIT --> CommandDispatcherInit
  SYS_CMDS_INIT --> CommandDispatcherInit